<wxs module="utils" src="./utils.wxs" />
<block wx:if="{{userInfo}}">
  <van-dropdown-menu active-color="#1989fa" dropdown-style="padding-top:{{statusBarHeight}}px">
    <van-dropdown-item id="item" title="核酸提醒">
      <view class="setting-item van-hairline--bottom" data-setting="0" bindtap="handleSelectSetting">
        <text>设置最近一次核酸时间</text>
      </view>
      <view class="setting-item" data-setting="1" bindtap="handleSelectSetting">
        <text>设置核酸有效时间</text>
      </view>
    </van-dropdown-item>
  </van-dropdown-menu>
  <image style="width: 200px; height: 200px; background-color: #eeeeee;" src="{{userInfo.avatarUrl}}"></image>
  <view>
    <text>{{ userInfo.nickName }}</text>
  </view>
  <view>
    <text>{{ soulSoupData.content }}</text>
  </view>
  <view>
    <text>最近一次核酸时间：{{ utils.formartTime(userInfo.lastHeSuanTime) }}</text>
  </view>
  <view>
    <text>距离核酸过期还有：</text>
    <van-count-down time="{{ time }}" format="DD 天 HH 时 mm 分"/>
  </view>
  <view>
    <text>核酸结果有效时间：{{ userInfo.expiration ? userInfo.expiration + ' 小时' : '' }}</text>
  </view>
</block>
<block wx:else>
  <block wx:if="{{register}}">
    <button wx:if="{{canIUseGetUserProfile}}" bindtap="getUserProfile" class="van-button van-button--info van-button--normal van-button--plain" hover-class="van-button--active hover-class">
      <van-icon size="1.2em" name="manager-o" class="van-button__icon" custom-style="line-height: inherit;" />
      <view class="van-button__text">注册新用户</view>
    </button>
    <button wx:else open-type="getUserInfo" bindgetuserinfo="getUserInfo" class="van-button van-button--info van-button--normal van-button--plain" hover-class="van-button--active hover-class">
      <van-icon size="1.2em" name="manager-o" class="van-button__icon" custom-style="line-height: inherit;" />
      <view class="van-button__text">注册新用户</view>
    </button>
  </block>custom-dialog
</block>
<van-dialog use-slot title="核酸有效时间(单位：小时)" show="{{ showDialog }}" show-cancel-button bind:close="handleCloseDialog" bind:confirm="handleConfirmDialog">
  <view class="dialog-input">
    <van-field model:value="{{ expirationInputValue }}" placeholder="请输入核酸有效时间" error="{{ expirationError }}" input-align="center" clearable type="number" />
  </view>
</van-dialog>
<van-popup show="{{ showPopup }}" round bind:close="onClose" position="bottom" custom-style="height:320px" bind:close="onClose">
  <van-datetime-picker type="datetime" value="{{ userInfo.lastHeSuanTime || formLastTime }}" title="最近一次核酸时间" max-date="{{ maxDate }}" formatter="{{ formatter }}" bind:confirm="handleSetLastTime" bind:cancel="handleCancelSetLastTime" />
</van-popup>
<van-toast id="van-toast" />